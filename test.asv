clc
clear
close("all");

% add EPANET-Matlab toolkit path
epanet_path = 'E:\Program Files\MATLAB\R2021b\toolbox\epanet\EPANET-Matlab-Toolkit-master';
run([epanet_path,'\start_toolkit']);

d = epanet('Net1.inp');

%%
d.setOptionsPatternDemandMultiplier(10);
d.setTimeSimulationDuration(0);
d.solveCompleteHydraulics;
deficient_nodes = d.getStatistic.DeficientNodes;
check_error(deficient_nodes == 4);

%%
type = 'PDA';
pmin = 0;
preq = 0.1;
pexp = 0.5;
d.setDemandModel(type,pmin,preq,pexp);
d.solveCompleteHydraulics;

deficient_nodes_PDA = d.getStatistic.DeficientNodes;
demand_reduction = d.getStatistic.DemandReduction;
check_error(deficient_nodes_PDA == 6);
check_error(abs(demand_reduction - 32.66) < 0.01);

junctionIndex_12 = d.getNodeIndex('12');
demand_e





